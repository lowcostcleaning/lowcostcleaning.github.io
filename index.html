<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Lowcost Cleaning ‚Äî –ö–∞–ª–µ–Ω–¥–∞—Ä—å</title>
  <style>
    :root {
      --bg-light: #f8f8f8;
      --text-primary: #111;
      --text-muted: #666;
      --accent: #000;
      --radius: 14px;
      --shadow-soft: 0 8px 20px rgba(0,0,0,0.06);
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, "SF Pro Display", Roboto, sans-serif;
      text-align: center;
      margin: 0;
      background: var(--bg-light);
      color: var(--text-primary);
      -webkit-font-smoothing: antialiased;
    }

    header {
      padding: 70px 20px 40px;
      animation: fadeIn 0.6s ease forwards;
    }

    h1 {
      margin: 0;
      font-size: 2rem;
      font-weight: 700;
      letter-spacing: -0.3px;
      display: flex;
      justify-content: center;
      align-items: center;
      gap: 6px;
    }

    p {
      color: var(--text-muted);
      margin-top: 10px;
      margin-bottom: 30px;
    }

    .service-group {
      background: rgba(255,255,255,0.7);
      border-radius: 18px;
      padding: 25px 20px 35px;
      margin: 25px auto;
      width: 90%;
      max-width: 620px;
      box-shadow: var(--shadow-soft);
      backdrop-filter: blur(10px);
      transition: 0.3s;
    }

    .service-group:hover { box-shadow: 0 12px 30px rgba(0,0,0,0.08); }
    .service-group h3 { font-size: 1.1rem; font-weight: 600; margin-bottom: 18px; color: #000; }
    .button-row { display: flex; flex-wrap: wrap; justify-content: center; gap: 10px; }

    .btn {
      background: rgba(255,255,255,0.8);
      color: #111;
      border: 1px solid rgba(0,0,0,0.08);
      padding: 14px 28px;
      border-radius: var(--radius);
      font-size: 1rem;
      cursor: pointer;
      transition: all 0.25s ease;
      box-shadow: 0 4px 12px rgba(0,0,0,0.05);
      backdrop-filter: blur(10px);
    }
    .btn:hover { background: rgba(255,255,255,0.95); transform: translateY(-2px); box-shadow: 0 8px 20px rgba(0,0,0,0.08); }
    .btn:active { transform: scale(0.97); box-shadow: 0 3px 8px rgba(0,0,0,0.1) inset; }

    .calendar-container { display: none; flex-direction: column; align-items: center; margin-top: 40px; opacity: 0; transform: translateY(20px); animation: fadeUp 0.6s ease forwards; }

    table { border-collapse: collapse; margin-top: 10px; box-shadow: var(--shadow-soft); border-radius: var(--radius); background: #fff; overflow: hidden; }
    th, td { width: calc(100% / 7); height: 70px; text-align: center; border-radius: 12px; vertical-align: middle; font-size: 0.9rem; transition: 0.2s ease; box-sizing: border-box; }
    table { width: 100%; max-width: 640px; border-collapse: separate; border-spacing: 6px; margin: 10px auto; background: #fff; border-radius: 20px; box-shadow: 0 10px 25px rgba(0,0,0,0.05); overflow: hidden; }
    th { color: var(--text-muted); font-weight: 600; }

    .available { background: rgba(52,199,89,0.15); color: #007a1c; cursor: pointer; }
    .available:hover { background: rgba(52,199,89,0.3); transform: scale(1.03); }
    .unavailable { background: rgba(255,59,48,0.25); color: #a40000; cursor: not-allowed; }
    .past { background: rgba(142,142,147,0.25); color: #8e8e93; cursor: not-allowed; }

    .legend { margin-top: 15px; font-size: 0.9rem; color: var(--text-muted); }
    .dot { display: inline-block; width: 12px; height: 12px; border-radius: 50%; margin-right: 6px; vertical-align: middle; border: 1px solid rgba(0,0,0,0.15); }
    .dot.free { background: rgba(52,199,89,0.4); border-color: rgba(52,199,89,0.5); }
    .dot.busy { background: rgba(255,59,48,0.4); border-color: rgba(255,59,48,0.5); }
    .dot.past { background: rgba(142,142,147,0.3); border-color: rgba(142,142,147,0.4); }

    .slots-row { margin-top: 6px; display: flex; justify-content: center; gap: 4px; }
    .slot-dot { width: 8px; height: 8px; border-radius: 50%; }
    .slot-dot.free { background: rgba(52,199,89,0.6); }
    .slot-dot.busy { background: rgba(255,59,48,0.7); }

    .modal { display: none; position: fixed; z-index: 10; left: 0; top: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); backdrop-filter: blur(8px); justify-content: center; align-items: center; }
    .modal-content { background: #fff; padding: 25px; border-radius: 16px; width: 90%; max-width: 360px; text-align: left; box-shadow: var(--shadow-soft); animation: fadeIn 0.3s ease; }
    .modal-content input, .modal-content select { width: 100%; padding: 10px; margin-bottom: 12px; border-radius: 8px; border: 1px solid #ccc; font-size: 1rem; transition: border-color 0.2s ease; }
    .modal-content input:focus, .modal-content select:focus { outline: none; border-color: #007aff; }

    .book-btn { background: #000; color: #fff; border: none; padding: 12px 20px; border-radius: 8px; font-size: 1rem; cursor: pointer; width: 100%; transition: background 0.3s ease; }
    .book-btn:hover { background: #333; }

    .close { float: right; font-size: 20px; cursor: pointer; color: #aaa; }
    .time-btn.active { background: #000 !important; color: #fff !important; }

    footer { margin-top: 80px; padding: 20px; color: var(--text-muted); font-size: 0.9rem; }

    @media (max-width: 480px) {
      th, td { height: 50px; font-size: 0.8rem; }
      .btn { padding: 10px 18px; font-size: 0.9rem; }
    }

    @keyframes fadeIn { from { opacity: 0; transform: scale(0.98); } to { opacity: 1; transform: scale(1); } }
    @keyframes fadeUp { from { opacity: 0; transform: translateY(30px); } to { opacity: 1; transform: translateY(0); } }
  </style>
</head>

<body>
  <header>
    <h1>üßπ Lowcost Cleaning</h1>
    <p>–í—ã–±–µ—Ä–∏—Ç–µ –∫–∞—Ç–µ–≥–æ—Ä–∏—é:</p>

    <div class="service-group">
      <h3>üë§ –î–ª—è —á–∞—Å—Ç–Ω—ã—Ö –ª–∏—Ü</h3>
      <div class="button-row">
        <button class="btn" onclick="chooseService('üè† –°—Ç—É–¥–∏—è ‚Äî 90‚Çæ', '–ì–ª–∞–≤–Ω—ã–π')">üè† –°—Ç—É–¥–∏—è ‚Äî 90‚Çæ</button>
        <button class="btn" onclick="chooseService('üõè 1+1 ‚Äî 120‚Çæ', '–ì–ª–∞–≤–Ω—ã–π')">üõè 1+1 ‚Äî 120‚Çæ</button>
        <button class="btn" onclick="chooseService('üß∫ –•–∏–º—á–∏—Å—Ç–∫–∞ ‚Äî 50‚Çæ', '–•–∏–º—á–∏—Å—Ç–∫–∞')">üß∫ –•–∏–º—á–∏—Å—Ç–∫–∞ ‚Äî 50‚Çæ</button>
      </div>
    </div>

    <div class="service-group">
      <h3>üè¢ –î–ª—è —É–ø—Ä–∞–≤–ª—è—é—â–∏—Ö –∫–æ–º–ø–∞–Ω–∏–π</h3>
      <div class="button-row">
        <button class="btn" onclick="chooseService('üè¢ –£–±–æ—Ä–∫–∞ –∞–ø–∞—Ä—Ç–∞–º–µ–Ω—Ç–æ–≤', '–ê–ø–∞—Ä—Ç–∞–º–µ–Ω—Ç—ã')">üè¢ –£–±–æ—Ä–∫–∞ –∞–ø–∞—Ä—Ç–∞–º–µ–Ω—Ç–æ–≤</button>
      </div>
    </div>
  </header>

  <div class="calendar-container" id="calendarContainer">
    <h2 id="monthLabel"></h2>
    <table id="calendar"></table>
    <div class="legend">
      <span class="dot free"></span> —Å–≤–æ–±–æ–¥–Ω–æ &nbsp;&nbsp;
      <span class="dot busy"></span> –∑–∞–Ω—è—Ç–æ &nbsp;&nbsp;
      <span class="dot past"></span> –ø—Ä–æ—à–ª–æ
    </div>
  </div>

  <footer>¬© 2025 Lowcost Cleaning</footer>

  <div id="bookingModal" class="modal">
    <div class="modal-content"></div>
  </div>

<script>
const BASE_URL="https://docs.google.com/spreadsheets/d/e/2PACX-1vS8zb-CjwcHeTuOYB5iT5jz5RdMPaz0_BrTT6E1jPtaXfSbh7O1xykOE5WI92idU6A-SZ2GLzdcgtMU/pub?gid=";
const gids={"–ì–ª–∞–≤–Ω—ã–π":"0","–•–∏–º—á–∏—Å—Ç–∫–∞":"591986483","–ê–ø–∞—Ä—Ç–∞–º–µ–Ω—Ç—ã":"1636464154"};
let selectedService="",selectedDate="",selectedTime="",currentSheet="";

/* --- –ø–æ–ª—É—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö --- */
async function getBusyDates(sheetName){
  const gid=gids[sheetName]||"0";
  const url=`${BASE_URL}${gid}&single=true&output=csv&nocache=${Date.now()}`;
  const res=await fetch(url,{cache:"no-store"});
  const text=await res.text();
  const rows=text.split("\n").map(r=>r.split(","));
  const busy=[];
  for(let i=1;i<rows.length;i++){
    const r=rows[i];
    if(!r||r.length<2)continue;
    let date=(r[0]||"").trim().replace(/"/g,"");
    const time=(r[1]||"").trim();
    const status=(r[r.length-1]||"").trim().toLowerCase();
    if(!date||!status.includes("–∑–∞–Ω—è—Ç–æ"))continue;
    if(date.includes(".")){const[d,m,y]=date.split(".");date=`${y}-${m.padStart(2,"0")}-${d.padStart(2,"0")}`;}
    busy.push(time?`${date} ${time}`:date);
  }
  return busy;
}

async function chooseService(service,sheet){
  selectedService=service;currentSheet=sheet;
  const container=document.getElementById("calendarContainer");
  const calendar=document.getElementById("calendar");
  container.style.display="flex";container.style.opacity="0";
  calendar.innerHTML="<tr><td colspan='7'>‚è≥ –ó–∞–≥—Ä—É–∑–∫–∞...</td></tr>";
  const busyDates=await getBusyDates(sheet);
  generateCalendar(busyDates);
  requestAnimationFrame(()=>{
    container.style.transition="opacity .6s ease";
    container.style.opacity="1";
    window.scrollTo({top:container.offsetTop-40,behavior:"smooth"});
  });
}

/* --- –≥–µ–Ω–µ—Ä–∞—Ü–∏—è –∫–∞–ª–µ–Ω–¥–∞—Ä—è --- */
function generateCalendar(busyDates=[]){
  const isApts=currentSheet==="–ê–ø–∞—Ä—Ç–∞–º–µ–Ω—Ç—ã";
  const calendar=document.getElementById("calendar");
  const monthLbl=document.getElementById("monthLabel");
  calendar.innerHTML="";
  const now=new Date(),year=now.getFullYear(),month=now.getMonth();
  const monthName=now.toLocaleString("ru-RU",{month:"long",year:"numeric"});
  monthLbl.textContent=monthName.charAt(0).toUpperCase()+monthName.slice(1);
  const firstDay=new Date(year,month,1).getDay();
  const offset=firstDay===0?6:firstDay-1;
  const daysInMonth=new Date(year,month+1,0).getDate();
  let html="<tr>";
  const weekDays=["–ü–Ω","–í—Ç","–°—Ä","–ß—Ç","–ü—Ç","–°–±","–í—Å"];
  html+=weekDays.map(d=>`<th>${d}</th>`).join("")+"</tr><tr>";
  const allTimes=["10:00","12:00","14:00","16:00","18:00"];
  const groupedByDate={},busyDaysSet=new Set();

  if(isApts){busyDates.forEach(v=>{const[d,t]=v.trim().split(" ");if(!d)return;if(!groupedByDate[d])groupedByDate[d]=new Set();if(t)groupedByDate[d].add(t.trim());});}
  else busyDates.forEach(v=>busyDaysSet.add(v.split(" ")[0]));

  for(let i=0;i<offset;i++)html+="<td></td>";
  for(let day=1;day<=daysInMonth;day++){
    const dateStr=`${year}-${String(month+1).padStart(2,"0")}-${String(day).padStart(2,"0")}`;
    const dateObj=new Date(dateStr);
    const isPast=dateObj<new Date(new Date().setHours(0,0,0,0));
    let className="",clickAttr="",inner=`<div>${day}</div>`;
    if(isApts){
      const busyTimes=Array.from(groupedByDate[dateStr]||[]);
      const freeTimes=allTimes.filter(t=>!busyTimes.includes(t));
      const allBusy=freeTimes.length===0;
      const dots=allTimes.map(t=>`<span class="slot-dot ${busyTimes.includes(t)?"busy":"free"}"></span>`).join("");
      inner+=`<div class="slots-row">${dots}</div>`;
      if(isPast)className="past";
      else if(allBusy)className="unavailable";
      else{className="available";clickAttr=`onclick='openModal("${dateStr}", ${JSON.stringify(busyTimes)})'`;}
    } else {
      if(isPast)className="past";
      else if(busyDaysSet.has(dateStr))className="unavailable";
      else{className="available";clickAttr=`onclick='openModal("${dateStr}")'`;}
    }
    html+=`<td class="${className}" ${clickAttr}>${inner}</td>`;
    if((day+offset)%7===0)html+="</tr><tr>";
  }
  html+="</tr>";
  calendar.innerHTML=html;
}

const modal=document.getElementById("bookingModal");

function openModal(date,busyTimes=[]){
  selectedDate=date;
  const content=document.querySelector(".modal-content");
  if(currentSheet==="–ê–ø–∞—Ä—Ç–∞–º–µ–Ω—Ç—ã"){
    const timeSlots=["10:00","12:00","14:00","16:00","18:00"];
    const slotOpts=timeSlots.map(t=>{
      const disabled=busyTimes.includes(t)?"disabled":"";
      return `<option value="${t}" ${disabled}>${t}</option>`;
    }).join("");
    content.innerHTML=`
      <span class="close" onclick="closeModal()">√ó</span>
      <h3>${selectedService}<br>üìÖ ${date}</h3>
      <form id="apartmentForm" action="https://vm62681.vpsone.xyz/webhook/apartments-booking" method="POST">
        <label>–í—Ä–µ–º—è:</label>
        <select name="time" required>${slotOpts}</select>
        <label>–ñ–ö:</label>
        <input type="text" name="complex" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: Orbi City" required>
        <label>–ê–ø–∞—Ä—Ç–∞–º–µ–Ω—Ç:</label>
        <input type="text" name="apartment" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: B-1210" required>
        <label>–£–ø—Ä–∞–≤–ª—è—é—â–∞—è –∫–æ–º–ø–∞–Ω–∏—è:</label>
        <input type="text" name="company" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: Orbi Group" required>
        <button type="submit" class="book-btn">–û—Ç–ø—Ä–∞–≤–∏—Ç—å</button>
      </form>`;
    const form=content.querySelector("#apartmentForm");
    form.addEventListener("submit",async(e)=>{
      e.preventDefault();
      const formData=new FormData(form);
      const json=Object.fromEntries(formData.entries());
      try{
        const res=await fetch(form.action,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(json)});
        if(res.ok){alert("‚úÖ –ó–∞—è–≤–∫–∞ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∞!");closeModal();}
        else alert("–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ.");
      }catch{alert("–û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è.");}
    });
  } else {
    content.innerHTML=`
      <span class="close" onclick="closeModal()">√ó</span>
      <h3>${selectedService}<br>üìÖ ${date}</h3>
      <input type="text" id="clientName" placeholder="–í–∞—à–µ –∏–º—è">
      <input type="tel" id="clientPhone" placeholder="–¢–µ–ª–µ—Ñ–æ–Ω">
      <button class="book-btn" onclick="sendBooking()">–ó–∞–±—Ä–æ–Ω–∏—Ä–æ–≤–∞—Ç—å</button>`;
  }
  modal.style.display="flex";
}

function closeModal(){modal.style.display="none";}

function sendBooking(){
  const name=(document.getElementById("clientName").value||"").trim();
  const phone=(document.getElementById("clientPhone").value||"").trim();
  if(!name||!phone){alert("–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –∑–∞–ø–æ–ª–Ω–∏—Ç–µ –∏–º—è –∏ —Ç–µ–ª–µ—Ñ–æ–Ω");return;}
  let msg=`üßπ –ù–æ–≤–∞—è –∑–∞–ø–∏—Å—å:\n${selectedService}\nüìÖ ${selectedDate}`;
  if(selectedTime)msg+=` ‚è∞ ${selectedTime}`;
  msg+=`\nüë§ ${name}\nüìû ${phone}`;
  window.open(`https://t.me/kalendaruborok_bot?text=${encodeURIComponent(msg)}`,"_blank");
  closeModal();
}
</script>
</body>
</html>
