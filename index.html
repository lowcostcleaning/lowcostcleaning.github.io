<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Lowcost Cleaning ‚Äî –ö–∞–ª–µ–Ω–¥–∞—Ä—å</title>
  <style>
    body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif; text-align: center; margin:0; }
    header { padding: 80px 20px 40px; }
    h1 { margin: 20px 0; }
    .btn { background: #000; color: #fff; border: none; padding: 14px 34px; border-radius: 12px; font-size: 1rem; cursor: pointer; margin: 5px; }
    .btn:hover { background: #333; }
    footer { margin-top: 50px; padding: 20px; color: #888; font-size: 0.9rem; }
    .calendar-container { display: none; flex-direction: column; align-items: center; margin-top: 30px; }
    .calendar-header { font-weight: bold; font-size: 1.3rem; }
    .calendar-table { border-collapse: collapse; margin-top: 10px; }
    th, td { width: 40px; height: 40px; text-align: center; border-radius: 8px; }
    th { color: #666; font-weight: 600; }
    td.day { cursor: pointer; transition: 0.2s; }
    .available { background: #e7fbe7; color: #0a0; }
    .available:hover { background: #c6f5c6; transform: scale(1.1); }
    .unavailable { background: #ffcccc; color: #a00; cursor: not-allowed; }
    .past { background: #eee; color: #999; cursor: not-allowed; }
    .legend { margin-top: 15px; font-size: 0.9rem; color: #666; }
    .modal { display: none; position: fixed; z-index: 10; left: 0; top: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.6); justify-content: center; align-items: center; }
    .modal-content { background: #fff; padding: 25px; border-radius: 16px; width: 90%; max-width: 360px; text-align: left; box-shadow: 0 8px 20px rgba(0,0,0,0.2); }
    .modal-content input { width: 100%; padding: 10px; margin-bottom: 12px; border-radius: 8px; border: 1px solid #ccc; font-size: 1rem; }
    .book-btn { background: #000; color: #fff; border: none; padding: 10px 20px; border-radius: 8px; font-size: 1rem; cursor: pointer; width: 100%; }
    .book-btn:hover { background: #333; }
    .close { float: right; font-size: 20px; cursor: pointer; color: #aaa; }
  </style>
</head>
<body>
  <header>
    <h1>üßπ Lowcost Cleaning</h1>
    <p>–£–±–æ—Ä–∫–∞ –ø–æ —Ñ–∏–∫—Å —Ü–µ–Ω–µ ‚Äî –≤—ã–±–µ—Ä–∏—Ç–µ –≤–∞—Ä–∏–∞–Ω—Ç</p>
    <button class="btn" onclick="chooseService('üè† –°—Ç—É–¥–∏—è ‚Äî 90‚Çæ')">üè† –°—Ç—É–¥–∏—è ‚Äî 90‚Çæ</button>
    <button class="btn" onclick="chooseService('üõè 1+1 ‚Äî 120‚Çæ')">üõè 1+1 ‚Äî 120‚Çæ</button>
  </header>

  <div class="calendar-container" id="calendarContainer">
    <div class="calendar-header" id="monthLabel"></div>
    <table class="calendar-table" id="calendar"></table>
    <div class="legend">üü¢ ‚Äî —Å–≤–æ–±–æ–¥–Ω–æ &nbsp;&nbsp;&nbsp; üî¥ ‚Äî –∑–∞–Ω—è—Ç–æ &nbsp;&nbsp;&nbsp; ‚ö™ ‚Äî –ø—Ä–æ—à–ª–æ</div>
  </div>

  <footer>¬© 2025 Lowcost Cleaning</footer>

  <!-- –ú–æ–¥–∞–ª–∫–∞ -->
  <div id="bookingModal" class="modal">
    <div class="modal-content">
      <span class="close" onclick="closeModal()">√ó</span>
      <h3 id="modalTitle">–ë—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ</h3>
      <input type="text" id="clientName" placeholder="–í–∞—à–µ –∏–º—è">
      <input type="tel" id="clientPhone" placeholder="–¢–µ–ª–µ—Ñ–æ–Ω">
      <button class="book-btn" onclick="sendBooking()">–ó–∞–±—Ä–æ–Ω–∏—Ä–æ–≤–∞—Ç—å</button>
    </div>
  </div>

  <script>
    const SHEET_ID = "1RuT1hrD76olFtMu4JDV5D9d5ocZ9Hlg5xQG3Wl9UInE";
    const SHEET_RANGE = "A:B";
    const API_URL = `https://docs.google.com/spreadsheets/d/${SHEET_ID}/gviz/tq?tqx=out:json&sheet=Sheet1&range=${SHEET_RANGE}`;

    let selectedService = "";
    let selectedDate = "";

    async function getBusyDates() {
      try {
        const res = await fetch(API_URL);
        const text = await res.text();
        const json = JSON.parse(text.substr(47).slice(0, -2));
        const rows = json.table.rows;
        const busy = [];
        for (const r of rows) {
          const date = r.c[0]?.v;
          const status = r.c[1]?.v?.toLowerCase();
          if (status === "–∑–∞–Ω—è—Ç–æ") busy.push(date);
        }
        return busy;
      } catch (err) {
        console.error("–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ –¥–∞–Ω–Ω—ã—Ö:", err);
        return [];
      }
    }

    async function chooseService(service) {
      selectedService = service;
      document.getElementById("calendarContainer").style.display = "flex";
      await generateCalendar();
      window.scrollTo({ top: document.getElementById("calendarContainer").offsetTop - 50, behavior: "smooth" });
    }

    async function generateCalendar() {
      const busyDates = await getBusyDates();

      const calendar = document.getElementById("calendar");
      const monthLabel = document.getElementById("monthLabel");
      calendar.innerHTML = "";

      const year = 2025, month = 9;
      const monthName = new Date(year, month).toLocaleString("ru-RU", { month: "long", year: "numeric" });
      monthLabel.textContent = monthName.charAt(0).toUpperCase() + monthName.slice(1);

      const firstDay = new Date(year, month, 1).getDay();
      const offset = (firstDay === 0 ? 6 : firstDay - 1);
      const daysInMonth = new Date(year, month + 1, 0).getDate();
      const today = new Date(); // —Ç–µ–∫—É—â–∞—è –¥–∞—Ç–∞

      // —à–∞–ø–∫–∞ –¥–Ω–µ–π –Ω–µ–¥–µ–ª–∏
      let html = "<tr>";
      const weekDays = ["–ü–Ω","–í—Ç","–°—Ä","–ß—Ç","–ü—Ç","–°–±","–í—Å"];
      html += weekDays.map(d => `<th>${d}</th>`).join("") + `</tr><tr>`;

      for (let i = 0; i < offset; i++) html += `<td></td>`;

      for (let i = 1; i <= daysInMonth; i++) {
        const dateStr = `${year}-${String(month + 1).padStart(2, "0")}-${String(i).padStart(2, "0")}`;
        const dateObj = new Date(dateStr);
        let className = "available";
        let click = `onclick="openModal('${dateStr}')"`;

        if (busyDates.includes(dateStr)) {
          className = "unavailable";
          click = "";
        } else if (dateObj < today) {
          className = "past";
          click = "";
        }

        html += `<td class="day ${className}" ${click}>${i}</td>`;
        if ((i + offset) % 7 === 0) html += `</tr><tr>`;
      }

      html += `</tr>`;
      calendar.innerHTML = html;
    }

    const modal = document.getElementById("bookingModal");
    function openModal(date) {
      selectedDate = date;
      document.getElementById("modalTitle").innerText = `${selectedService}\nüìÖ ${date}`;
      modal.style.display = "flex";
    }
    function closeModal() {
      modal.style.display = "none";
    }

    function sendBooking() {
      const name = document.getElementById("clientName").value.trim();
      const phone = document.getElementById("clientPhone").value.trim();
      if (!name || !phone) {
        alert("–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –∑–∞–ø–æ–ª–Ω–∏—Ç–µ –∏–º—è –∏ —Ç–µ–ª–µ—Ñ–æ–Ω");
        return;
      }
      const message = encodeURIComponent(
        `üßπ –ù–æ–≤–∞—è –∑–∞–ø–∏—Å—å –Ω–∞ —É–±–æ—Ä–∫—É:\n${selectedService}\nüìÖ ${selectedDate}\nüë§ –ò–º—è: ${name}\nüìû –¢–µ–ª–µ—Ñ–æ–Ω: ${phone}`
      );
      const telegramLink = `https://t.me/kalendaruborok_bot?text=${message}`;
      window.open(telegramLink, "_blank");
      closeModal();
    }
  </script>
</body>
</html>
